---
type: review
doc_type: Requirements Review
status: Implemented
created: 2026-02-05
updated: 2026-02-05
---

# 업무일지 & 단계 관리 개선 요구사항 검토 ✅ 구현 완료

> 개발 전 요구사항 검토 문서 - **구현 완료 (2026-02-05)**

---

## 1. 요구사항 요약

| # | 항목 | 현재 상태 | 확정된 요구사항 |
|---|------|----------|----------------|
| 1 | 날짜 입력 | 텍스트만 가능 | **달력(date picker)** UI 추가 |
| 2 | 단계 변경 → 프로젝트 연동 | ❌ 미구현 | **팀장만** 단계 변경, 프로젝트 자동 반영 |
| 3 | 프로젝트 단계 되돌리기 | ❌ 불가능 | 이전 단계로 되돌리기 가능 (이력은 업무일지) |
| 4 | 업무일지 이슈사항 | ❌ 미구현 | issue + issueStatus 필드, 프로젝트 자동 반영 |

---

## 2. 상세 분석

### 2.1 날짜 입력 개선 ✅ 확정

**현재 구현:**
- [WorklogFormClient.tsx:257-263](src/app/worklogs/new/WorklogFormClient.tsx#L257-L263)
- 텍스트 입력만 가능 (자동 포맷팅: 20260205 → 2026-02-05)

**확정된 요구사항:**
- 달력(date picker) UI 추가
- 텍스트 입력도 유지 (20260205 형식 지원)

**확정 구현:**
```
<input type="date" /> 사용 (프로젝트 폼과 동일)
- 참조: ProjectFormClient.tsx:401, 410
- 브라우저 기본 date picker 사용
- 통일성 유지
```

---

### 2.2 단계 변경 → 프로젝트 연동 ✅ 확정

**현재 구현:**
- 업무일지 작성 시 단계 선택 → 프로젝트 currentStage와 별개
- 프로젝트 단계 변경은 프로젝트 상세 페이지에서만 가능

**확정된 요구사항:**
1. **팀장**이 업무일지 작성 시:
   - 단계 선택 가능 (드롭다운 활성화)
   - 단계 변경 시 프로젝트 currentStage 자동 업데이트

2. **팀원**이 업무일지 작성 시:
   - 단계 선택 불가 (프로젝트 currentStage로 고정, 비활성화)

**권한 체크 로직:**
```
팀장 여부 = (session.user.id === project.teamLeaderId)
```

**확정 구현:**
```
팀장: 단계 드롭다운 활성화, 변경 시 프로젝트 자동 반영
팀원: 단계 드롭다운 비활성화 (currentStage 읽기 전용)
```

---

### 2.3 프로젝트 단계 되돌리기 ✅ 확정

**현재 구현:**
- [ProjectDetailClient.tsx:198-201](src/app/projects/[id]/ProjectDetailClient.tsx#L198-L201)
```typescript
// 이미 완료된 단계는 클릭 불가 (되돌리기 불가)
if (clickedIndex < currentIndex) {
  return;
}
```

**확정된 요구사항:**
- 설계 → P1 진행 후 실패 시 → 설계로 되돌아가야 함
- 이전 상태 이력: 업무일지로 확인 가능 (별도 표시 불필요)

**확정 구현:**
```
완료된 단계 클릭 → 확인 팝업 → 해당 단계로 되돌아가기
- currentStage = 클릭한 단계
- 이력은 ProjectHistory에 기록
- 되돌아간 이후 단계는 다시 ⚪예정 상태로 표시
```

**시각적 표현:**
```
현재 방식 유지: 🟢완료 → 🟡진행중 → ⚪예정 (순서 기반)
되돌아가면 이후 단계는 자동으로 ⚪예정 상태
```

---

### 2.4 업무일지 이슈사항 (issue) ✅ 방향 확정

**핵심 철학:**
> 모든 정보가 프로젝트로 향해야 함. 업무일지는 프로젝트 진행 이력 관리 수단.

**현재 상태:**
- `Project.issues` 필드 존재 (프로젝트 레벨)
- `WorkLog`에는 issue 필드 없음

**확정된 요구사항:**
1. 작성: 업무일지 작성 시 이슈사항 입력
2. 집계: 프로젝트에는 **마지막 이슈사항**만 표시
3. 해결 추적: **필요함**

---

#### 확정 설계: 업무일지 기반 이슈사항 관리

**데이터 흐름:**
```
업무일지 작성 (issue 입력)
    ↓
프로젝트.issues 자동 업데이트 (최신 이슈사항)
    ↓
대시보드에서 프로젝트별 이슈사항 표시
    ↓
업무일지에서 "해결됨" 체크
    ↓
프로젝트.issues 클리어 (또는 해결 표시)
```

**WorkLog 타입 변경:**
```typescript
interface WorkLog {
  // ... 기존 필드
  issue?: string;           // 이슈사항 내용
  issueStatus?: 'open' | 'resolved';  // 이슈사항 상태
  issueResolvedAt?: string; // 해결일시
}
```

**Project.issues 자동 업데이트 로직:**
```
1. 업무일지 저장 시:
   - issue가 있고 issueStatus = 'open' → 프로젝트.issues 업데이트
   - issueStatus = 'resolved' → 프로젝트.issues 클리어 (또는 "[해결됨]" 표시)

2. 프로젝트.issues 표시:
   - 해당 프로젝트의 가장 최근 미해결 이슈사항
   - 또는 "없음"
```

**UI 흐름:**
```
[업무일지 작성 페이지]
├─ 이슈사항: [텍스트 입력란]
└─ (수정 시) ☑️ 해결됨 체크박스

[프로젝트 상세 페이지]
└─ 현재 이슈사항: "xxx 문제 발생" (2026-02-05)

[대시보드]
└─ 이슈사항 현황: 프로젝트별 현재 이슈사항 목록
```

**이력 확인:**
- 과거 이슈사항 → 업무일지 목록에서 확인 (issue 필드 검색)
- 해결 이력 → 업무일지에서 issueStatus = 'resolved' 인 건 조회

---

## 3. 검토 필요 사항

### 3.1 단계 변경 권한

| 권한 | 업무일지 단계 선택 | 프로젝트 단계 반영 |
|-----|------------------|------------------|
| 팀장 | ✅ 가능 | ✅ 가능 (선택적) |
| 팀원 | ? | ❌ 불가 |

**질문:** 팀원의 단계 선택 가능 여부?

### 3.2 단계 되돌리기

| 상황 | 현재 | 변경 후 |
|-----|-----|--------|
| 완료 단계 클릭 | 무시 | 되돌아가기 확인 팝업 |
| 단계 상태 표시 | currentStage 기준 | currentStage 기준 (동일) |

**질문:** 되돌아간 후에도 "이전에 완료했었음" 표시가 필요한지?

### 3.3 이슈사항 관리

| 항목 | 옵션 A (단순) | 옵션 B (별도 시트) | 옵션 C (혼합) |
|-----|-------------|------------------|-------------|
| 복잡도 | 낮음 | 높음 | 중간 |
| 해결 추적 | ❌ | ✅ | ❌ |
| 집계/통계 | 어려움 | 쉬움 | 중간 |
| 구현 시간 | 짧음 | 김 | 중간 |

---

## 4. 확정 구현 방안 ✅ 전체 확정

### 구현 항목
1. ✅ 날짜 입력에 달력(date picker) UI 추가
2. ✅ 업무일지에 `issue`, `issueStatus` 필드 추가
3. ✅ 업무일지 저장 시 → 프로젝트.issues 자동 업데이트
4. ✅ 이슈사항 해결 추적 (issueStatus: open/resolved)
5. ✅ 팀장만 단계 변경 가능 (팀원은 currentStage 고정)
6. ✅ 프로젝트 단계 되돌리기 활성화 (별도 이력 표시 불필요)

### 수정 대상 파일
```
src/types/worklog.ts          - issue, issueStatus 필드 추가
src/app/api/worklogs/route.ts - issue 저장 + 프로젝트 연동 + 단계 연동
src/app/worklogs/new/WorklogFormClient.tsx - 이슈사항 UI + 팀장 권한 체크
src/app/projects/[id]/ProjectDetailClient.tsx - 단계 되돌리기 허용
Google Sheets WorkLogs 시트   - issue, issueStatus 컬럼 추가
```

### 단계 권한 로직 요약
```
업무일지 작성 시:
├─ 팀장 (session.user.id === project.teamLeaderId)
│   ├─ 단계 드롭다운: 활성화
│   └─ 단계 변경 시: 프로젝트 currentStage 자동 업데이트
│
└─ 팀원
    ├─ 단계 드롭다운: 비활성화 (읽기 전용)
    └─ 표시값: 프로젝트 currentStage 고정
```

### 단계 되돌리기 로직 요약
```
프로젝트 상세 페이지:
├─ 완료된 단계 클릭 → 해당 단계로 되돌아가기 확인 팝업
├─ 확인 시 → currentStage 변경 (이력은 ProjectHistory에 기록)
└─ 표시: 되돌아간 이후 단계는 다시 ⚪예정 상태
```

---

## 5. 결정 필요 사항

아래 항목에 대한 결정이 필요합니다:

- [x] **Q1**: 팀원이 업무일지 단계를 선택할 수 있게 할지? → **팀장만 가능** ✅ 확정
  - 팀장: 단계 드롭다운 활성화 + 프로젝트 단계 자동 반영
  - 팀원: 단계 드롭다운 비활성화 (프로젝트 currentStage 고정 표시)

- [x] **Q2**: 이슈사항 관리 방식 → **업무일지 기반 + 해결 추적** ✅ 확정
  - 업무일지에 issue, issueStatus 필드 추가
  - 프로젝트.issues는 최신 미해결 이슈사항 자동 반영

- [x] **Q3**: 되돌아간 단계의 "이전 완료 이력" 표시가 필요한지? → **불필요** ✅ 확정
  - 되돌아가면 다시 예정 상태로 표시
  - 이력은 업무일지에서 확인 가능

---

## 6. 관련 파일

### 수정 예상 파일
- `src/types/worklog.ts` - issue 필드 추가
- `src/app/worklogs/new/WorklogFormClient.tsx` - 권한 체크, issue 입력란
- `src/app/api/worklogs/route.ts` - issue 저장
- `src/app/projects/[id]/ProjectDetailClient.tsx` - 단계 되돌리기
- Google Sheets WorkLogs 시트 - issue 컬럼 추가

### 참조 문서
- [PRD.md](../01-planning/PRD.md) - 3.2 업무일지 관리
- [Roadmap.md](../01-planning/Roadmap.md) - 2.12 업무일지 작성
- [PROGRESS.md](PROGRESS.md) - 1.5 업무일지 CRUD